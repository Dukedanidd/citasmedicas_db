module.exports = {

"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/timers [external] (timers, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("timers", () => require("timers"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/string_decoder [external] (string_decoder, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("string_decoder", () => require("string_decoder"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("url", () => require("url"));

module.exports = mod;
}}),
"[project]/app/api/citas/route.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "DELETE": (()=>DELETE),
    "GET": (()=>GET),
    "POST": (()=>POST),
    "PUT": (()=>PUT)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/mysql2/promise.js [app-route] (ecmascript)");
;
;
// Configuración de la base de datos
const dbConfig = {
    host: process.env.DB_HOST || 'localhost',
    user: process.env.DB_USER || 'root',
    password: process.env.DB_PASSWORD || '',
    database: process.env.DB_NAME || 'clinica_db'
};
async function GET(request) {
    console.log('[GET /api/citas] Iniciando petición...');
    let conn;
    try {
        const { searchParams } = new URL(request.url);
        const citaId = searchParams.get('citaId');
        const pacienteId = searchParams.get('pacienteId');
        const doctorId = searchParams.get('doctorId');
        console.log('[GET /api/citas] Parámetros:', {
            citaId,
            pacienteId,
            doctorId
        });
        console.log('[GET /api/citas] Conectando a la base de datos...');
        conn = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createConnection(dbConfig);
        console.log('[GET /api/citas] Conexión exitosa');
        // Asignar current_user_id para los triggers
        await conn.execute('SET @current_user_id = 1');
        console.log('[GET /api/citas] current_user_id asignado');
        let query = `
      SELECT 
        c.*,
        p.primer_nombre as paciente_nombre,
        p.apellido_paterno as paciente_apellido,
        d.primer_nombre as doctor_nombre,
        d.apellido_paterno as doctor_apellido,
        e.nombre as estado_nombre
      FROM citas c
      JOIN usuarios p ON c.paciente_id = p.user_id
      JOIN usuarios d ON c.doctor_id = d.user_id
      JOIN estado_citas e ON c.estado_id = e.estado_id
      WHERE 1=1
    `;
        const params = [];
        if (citaId) {
            query += ' AND c.cita_id = ?';
            params.push(citaId);
        }
        if (pacienteId) {
            query += ' AND c.paciente_id = ?';
            params.push(pacienteId);
        }
        if (doctorId) {
            query += ' AND c.doctor_id = ?';
            params.push(doctorId);
        }
        console.log('[GET /api/citas] Ejecutando query:', query);
        const [rows] = await conn.execute(query, params);
        console.log('[GET /api/citas] Resultados:', rows);
        if (citaId && !rows[0]) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Cita no encontrada'
            }, {
                status: 404
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(citaId ? rows[0] : rows);
    } catch (error) {
        console.error('[GET /api/citas] Error:', error);
        console.error('[GET /api/citas] Stack trace:', error.stack);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Error al obtener citas'
        }, {
            status: 500
        });
    } finally{
        if (conn) {
            await conn.end();
            console.log('[GET /api/citas] Conexión cerrada');
        }
    }
}
async function POST(request) {
    console.log('[POST /api/citas] Iniciando petición...');
    let conn;
    try {
        const data = await request.json();
        console.log('[POST /api/citas] Datos recibidos:', data);
        const { paciente_id, doctor_id, fecha_hora, estado_id, notas } = data;
        if (!paciente_id || !doctor_id || !fecha_hora || !estado_id) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Faltan campos requeridos'
            }, {
                status: 400
            });
        }
        console.log('[POST /api/citas] Conectando a la base de datos...');
        conn = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createConnection(dbConfig);
        console.log('[POST /api/citas] Conexión exitosa');
        // Iniciar transacción
        await conn.beginTransaction();
        console.log('[POST /api/citas] Transacción iniciada');
        // Asignar current_user_id para los triggers
        await conn.execute('SET @current_user_id = 1');
        console.log('[POST /api/citas] current_user_id asignado');
        // Verificar si el paciente existe
        console.log('[POST /api/citas] Verificando paciente...');
        const [paciente] = await conn.execute('SELECT user_id FROM usuarios WHERE user_id = ?', [
            paciente_id
        ]);
        if (!paciente[0]) {
            await conn.rollback();
            console.log('[POST /api/citas] Paciente no encontrado');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'El paciente especificado no existe'
            }, {
                status: 400
            });
        }
        // Verificar si el doctor existe
        console.log('[POST /api/citas] Verificando doctor...');
        const [doctor] = await conn.execute('SELECT user_id FROM usuarios WHERE user_id = ?', [
            doctor_id
        ]);
        if (!doctor[0]) {
            await conn.rollback();
            console.log('[POST /api/citas] Doctor no encontrado');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'El doctor especificado no existe'
            }, {
                status: 400
            });
        }
        // Verificar si el estado existe
        console.log('[POST /api/citas] Verificando estado...');
        const [estado] = await conn.execute('SELECT estado_id FROM estado_citas WHERE estado_id = ?', [
            estado_id
        ]);
        if (!estado[0]) {
            await conn.rollback();
            console.log('[POST /api/citas] Estado no encontrado');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'El estado especificado no existe'
            }, {
                status: 400
            });
        }
        // Verificar disponibilidad del doctor
        console.log('[POST /api/citas] Verificando disponibilidad del doctor...');
        const [citasExistentes] = await conn.execute(`
      SELECT cita_id FROM citas 
      WHERE doctor_id = ? 
      AND fecha_hora = ?
      AND estado_id != 3
    `, [
            doctor_id,
            fecha_hora
        ]);
        if (citasExistentes.length > 0) {
            await conn.rollback();
            console.log('[POST /api/citas] Doctor no disponible en la fecha/hora especificada');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'El doctor no está disponible en la fecha y hora especificadas'
            }, {
                status: 400
            });
        }
        // Crear la cita
        console.log('[POST /api/citas] Creando cita...');
        const [result] = await conn.execute(`
      INSERT INTO citas (
        paciente_id,
        doctor_id,
        fecha_hora,
        estado_id,
        notas
      ) VALUES (?, ?, ?, ?, ?)
    `, [
            paciente_id,
            doctor_id,
            fecha_hora,
            estado_id,
            notas || null
        ]);
        await conn.commit();
        console.log('[POST /api/citas] Transacción completada');
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: 'Cita creada exitosamente',
            cita_id: result.insertId
        }, {
            status: 201
        });
    } catch (error) {
        console.error('[POST /api/citas] Error:', error);
        console.error('[POST /api/citas] Stack trace:', error.stack);
        if (conn) {
            await conn.rollback();
            console.log('[POST /api/citas] Transacción revertida');
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Error al crear cita'
        }, {
            status: 500
        });
    } finally{
        if (conn) {
            await conn.end();
            console.log('[POST /api/citas] Conexión cerrada');
        }
    }
}
async function PUT(request) {
    console.log('[PUT /api/citas] Iniciando petición...');
    let conn;
    try {
        const data = await request.json();
        console.log('[PUT /api/citas] Datos recibidos:', data);
        const { cita_id, paciente_id, doctor_id, fecha_hora, estado_id, notas } = data;
        if (!cita_id) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'ID de cita requerido'
            }, {
                status: 400
            });
        }
        console.log('[PUT /api/citas] Conectando a la base de datos...');
        conn = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createConnection(dbConfig);
        console.log('[PUT /api/citas] Conexión exitosa');
        // Iniciar transacción
        await conn.beginTransaction();
        console.log('[PUT /api/citas] Transacción iniciada');
        // Asignar current_user_id para los triggers
        await conn.execute('SET @current_user_id = 1');
        console.log('[PUT /api/citas] current_user_id asignado');
        // Verificar si la cita existe
        console.log('[PUT /api/citas] Verificando cita...');
        const [cita] = await conn.execute('SELECT cita_id FROM citas WHERE cita_id = ?', [
            cita_id
        ]);
        if (!cita[0]) {
            await conn.rollback();
            console.log('[PUT /api/citas] Cita no encontrada');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Cita no encontrada'
            }, {
                status: 404
            });
        }
        // Verificar si el paciente existe si se está actualizando
        if (paciente_id) {
            console.log('[PUT /api/citas] Verificando paciente...');
            const [paciente] = await conn.execute('SELECT user_id FROM usuarios WHERE user_id = ?', [
                paciente_id
            ]);
            if (!paciente[0]) {
                await conn.rollback();
                console.log('[PUT /api/citas] Paciente no encontrado');
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: 'El paciente especificado no existe'
                }, {
                    status: 400
                });
            }
        }
        // Verificar si el doctor existe si se está actualizando
        if (doctor_id) {
            console.log('[PUT /api/citas] Verificando doctor...');
            const [doctor] = await conn.execute('SELECT user_id FROM usuarios WHERE user_id = ?', [
                doctor_id
            ]);
            if (!doctor[0]) {
                await conn.rollback();
                console.log('[PUT /api/citas] Doctor no encontrado');
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: 'El doctor especificado no existe'
                }, {
                    status: 400
                });
            }
        }
        // Verificar si el estado existe si se está actualizando
        if (estado_id) {
            console.log('[PUT /api/citas] Verificando estado...');
            const [estado] = await conn.execute('SELECT estado_id FROM estado_citas WHERE estado_id = ?', [
                estado_id
            ]);
            if (!estado[0]) {
                await conn.rollback();
                console.log('[PUT /api/citas] Estado no encontrado');
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: 'El estado especificado no existe'
                }, {
                    status: 400
                });
            }
        }
        // Verificar disponibilidad del doctor si se está actualizando fecha/hora
        if (doctor_id && fecha_hora) {
            console.log('[PUT /api/citas] Verificando disponibilidad del doctor...');
            const [citasExistentes] = await conn.execute(`
        SELECT cita_id FROM citas 
        WHERE doctor_id = ? 
        AND fecha_hora = ?
        AND estado_id != 3
        AND cita_id != ?
      `, [
                doctor_id,
                fecha_hora,
                cita_id
            ]);
            if (citasExistentes.length > 0) {
                await conn.rollback();
                console.log('[PUT /api/citas] Doctor no disponible en la fecha/hora especificada');
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: 'El doctor no está disponible en la fecha y hora especificadas'
                }, {
                    status: 400
                });
            }
        }
        // Actualizar la cita
        console.log('[PUT /api/citas] Actualizando cita...');
        await conn.execute(`
      UPDATE citas
      SET paciente_id = COALESCE(?, paciente_id),
          doctor_id = COALESCE(?, doctor_id),
          fecha_hora = COALESCE(?, fecha_hora),
          estado_id = COALESCE(?, estado_id),
          notas = COALESCE(?, notas)
      WHERE cita_id = ?
    `, [
            paciente_id,
            doctor_id,
            fecha_hora,
            estado_id,
            notas,
            cita_id
        ]);
        await conn.commit();
        console.log('[PUT /api/citas] Transacción completada');
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: 'Cita actualizada exitosamente'
        });
    } catch (error) {
        console.error('[PUT /api/citas] Error:', error);
        console.error('[PUT /api/citas] Stack trace:', error.stack);
        if (conn) {
            await conn.rollback();
            console.log('[PUT /api/citas] Transacción revertida');
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Error al actualizar cita'
        }, {
            status: 500
        });
    } finally{
        if (conn) {
            await conn.end();
            console.log('[PUT /api/citas] Conexión cerrada');
        }
    }
}
async function DELETE(request) {
    console.log('[DELETE /api/citas] Iniciando petición...');
    let conn;
    try {
        const { searchParams } = new URL(request.url);
        const citaId = searchParams.get('citaId');
        console.log('[DELETE /api/citas] ID de cita:', citaId);
        if (!citaId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'ID de cita requerido'
            }, {
                status: 400
            });
        }
        console.log('[DELETE /api/citas] Conectando a la base de datos...');
        conn = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createConnection(dbConfig);
        console.log('[DELETE /api/citas] Conexión exitosa');
        // Iniciar transacción
        await conn.beginTransaction();
        console.log('[DELETE /api/citas] Transacción iniciada');
        // Asignar current_user_id para los triggers
        await conn.execute('SET @current_user_id = 1');
        console.log('[DELETE /api/citas] current_user_id asignado');
        // Verificar si la cita existe
        console.log('[DELETE /api/citas] Verificando cita...');
        const [cita] = await conn.execute('SELECT cita_id FROM citas WHERE cita_id = ?', [
            citaId
        ]);
        if (!cita[0]) {
            await conn.rollback();
            console.log('[DELETE /api/citas] Cita no encontrada');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Cita no encontrada'
            }, {
                status: 404
            });
        }
        // Eliminar la cita
        console.log('[DELETE /api/citas] Eliminando cita...');
        await conn.execute('DELETE FROM citas WHERE cita_id = ?', [
            citaId
        ]);
        await conn.commit();
        console.log('[DELETE /api/citas] Transacción completada');
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: 'Cita eliminada exitosamente'
        });
    } catch (error) {
        console.error('[DELETE /api/citas] Error:', error);
        console.error('[DELETE /api/citas] Stack trace:', error.stack);
        if (conn) {
            await conn.rollback();
            console.log('[DELETE /api/citas] Transacción revertida');
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Error al eliminar cita'
        }, {
            status: 500
        });
    } finally{
        if (conn) {
            await conn.end();
            console.log('[DELETE /api/citas] Conexión cerrada');
        }
    }
}
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: __turbopack_require_real__ } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__d96ddc._.js.map